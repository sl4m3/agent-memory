# Threat Model: Agent Memory MCP Server

Этот документ описывает модель угроз и принятые меры безопасности для транспортного слоя MCP.

## 1. Доверие к клиенту (Identity & Authority)
- **Угроза**: Любое приложение, подключенное по stdio, получает права роли по умолчанию.
- **Риск**: Высокий (скомпрометированный агент может изменить правила поведения системы).
- **Меры**: 
    - Разделение на роли `viewer`, `agent`, `admin`.
    - Роль `agent` не имеет прав на `accept_proposal` (PI1).
    - Роль по умолчанию — `viewer`.

## 2. Атаки на контент (Injection)
- **Угроза**: Запись вредоносных инструкций под видом решений.
- **Риск**: Средний (рефлексия и инварианты PI1/PI2 отфильтровывают шум).
- **Меры**: 
    - Принудительный префикс `[via MCP:role]` для всех записей.
    - Семантическая проверка длины и качества обоснования (Rationale).

## 3. Ресурсное истощение (DoS)
- **Угроза**: Создание тысяч мелких файлов в Git.
- **Риск**: Низкий (локальное хранилище).
- **Меры**:
    - Внедрение Cooldown на запись (см. `MCPServer.cooldown`).

## 4. Границы данных (Trust Zones)
- **Угроза**: MCP-клиент пытается заменить решение, созданное человеком локально.
- **Риск**: Критичный.
- **Меры**:
    - **Isolation Rule**: MCP-роль `agent` может вызывать `supersede` только для файлов, которые сами помечены тегом `via_mcp`. Человеческие решения для них — Read Only.
